<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>BeautyBucket — Shop Cosmetics</title>
  <style>
    /* basic reset & typography */
    * { box-sizing: border-box; margin:0; padding:0; }
    body { font-family: Arial, sans-serif; background: #f9f9f9; color: #333; }
    a { text-decoration: none; color: inherit; }
    button { cursor: pointer; }

    /* header */
    .site-header { background: #ff4da6; color: white; text-align: center; padding: 16px; }
    .site-header h1 { margin: 0; font-size: 24px; }
    .site-header .sub { font-size: 14px; opacity: 0.9; }

    /* layout */
    .container { display: flex; flex-wrap: wrap; max-width: 1100px; margin: auto; padding: 16px; }
    .sidebar { flex: 1 1 220px; background: white; padding: 16px; border-radius: 8px; margin-bottom:16px; }
    .content { flex: 3 1 0; padding-left: 16px; }

    /* filters */
    .filter-group { margin-bottom: 20px; }
    .filter-group h4 { margin-bottom: 8px; font-size: 16px; }
    .filter-group label { display: block; margin-bottom: 6px; font-size: 14px; cursor: pointer; }

    /* search bar */
    #searchInput { width: 100%; padding: 8px 10px; border: 1px solid #ccc; border-radius: 6px; margin-bottom: 16px; }

    /* products grid */
    .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; }
    .product-card { background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); overflow: hidden; display: flex; flex-direction: column; }
    .product-card img { width:100%; object-fit: contain; background: #fff; }
    .p-body { padding: 12px; flex: 1; display: flex; flex-direction: column; }
    .p-title { font-size: 18px; margin-bottom: 6px; }
    .p-cat { font-size: 13px; color: #777; margin-bottom: 8px; }
    .p-details { font-size: 14px; color: #555; margin-bottom: 12px; }
    .prices { margin-top: auto; }
    .prices .mrp { color: #888; text-decoration: line-through; font-size: 14px; }
    .prices .discount { color: #d6336c; font-weight: bold; margin-top: 4px; font-size: 15px; }
    .btn-buy { background: #25D366; color: white; border: none; padding: 10px; border-radius: 6px; font-size: 15px; margin-top:12px; }
    .stock { margin-top:8px; font-size: 13px; color: #2b7a0b; }

    @media (max-width: 800px) {
      .container { flex-direction: column; }
      .content { padding-left: 0; }
    }
  </style>
</head>
<body>

  <header class="site-header">
    <h1>BeautyBucket</h1>
    <div class="sub">Quality Cosmetics. Quick Delivery.</div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <div class="filter-group">
        <h4>Search Products</h4>
        <input type="text" id="searchInput" placeholder="Search...">
      </div>

      <div class="filter-group" id="categoryFilter">
        <h4>Filter by Category</h4>
        <!-- categories checkboxes will be inserted here -->
      </div>

      <div class="filter-group">
        <label><input type="checkbox" id="inStockOnly"> In Stock Only</label>
      </div>

      <button id="clearFilters">Clear Filters</button>
    </aside>

    <section class="content">
      <div id="productList" class="products"></div>
    </section>
  </div>

  <footer style="text-align:center; padding:16px; color:#777;">
    &copy; BeautyBucket
  </footer>

  <script>
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQA2pIOTPv2AVnMSWtlKLJeSXQXxTllgHn2gGYcdd_ZbHARLmclz_OXy009Aw9hJqgpc-RXIk_HXkK4/pub?gid=125100016&single=true&output=csv";

    let allProducts = [];
    let activeFilters = { categories: new Set(), inStock: false, search: '' };

    function parseCSV(text) {
      text = text.replace(/^\uFEFF/, '').trim();
      const rows = []; let cur = ['']; let col=0, inQuotes=false;
      for (let i=0; i<text.length; i++) {
        const ch = text[i], nxt = text[i+1];
        if (ch === '"') {
          if (inQuotes && nxt === '"') { cur[col] += '"'; i++; continue; }
          inQuotes = !inQuotes; continue;
        }
        if (!inQuotes && ch === ',') { col++; cur[col]=''; continue; }
        if (!inQuotes && (ch === '\n' || ch === '\r')) {
          rows.push(cur);
          cur = ['']; col=0;
          if (ch === '\r' && nxt === '\n') i++;
          continue;
        }
        cur[col] += ch;
      }
      if (cur.length>1 || cur[0].trim()!=='') rows.push(cur);
      const headers = rows.shift().map(h => h.trim());
      return rows.map(r => {
        const o = {};
        for (let i=0; i<headers.length; i++) o[headers[i]] = (r[i]||'').trim();
        return o;
      });
    }

    function loadProducts() {
      fetch(CSV_URL).then(r => r.text()).then(t => {
        allProducts = parseCSV(t);
        setupFilters();
        render();
      }).catch(err => console.error("CSV load error:", err));
    }

    function setupFilters() {
      const cats = Array.from(new Set(allProducts.map(p => p.Category || '').filter(Boolean)));
      const container = document.getElementById('categoryFilter');
      cats.forEach(c => {
        const id = 'cat_'+c.replace(/\s+/g,'_');
        const lbl = document.createElement('label');
        lbl.style.display = 'block';
        lbl.innerHTML = `<input type="checkbox" id="${id}" value="${c}"> ${c}`;
        container.append(lbl);
        document.getElementById(id).addEventListener('change', e => {
          if (e.target.checked) activeFilters.categories.add(e.target.value);
          else activeFilters.categories.delete(e.target.value);
          render();
        });
      });

      document.getElementById('inStockOnly').addEventListener('change', e => {
        activeFilters.inStock = e.target.checked;
        render();
      });

      document.getElementById('searchInput').addEventListener('input', e => {
        activeFilters.search = e.target.value.trim().toLowerCase();
        render();
      });

      document.getElementById('clearFilters').addEventListener('click', () => {
        activeFilters.categories.clear();
        activeFilters.inStock = false;
        activeFilters.search = '';
        document.getElementById('inStockOnly').checked = false;
        document.getElementById('searchInput').value = '';
        document.querySelectorAll('#categoryFilter input[type=checkbox]').forEach(cb => cb.checked = false);
        render();
      });
    }

    function render() {
      const listEl = document.getElementById('productList');
      listEl.innerHTML = '';

      const filtered = allProducts.filter(p => {
        if (activeFilters.inStock && (!(p.Stock) || parseInt(p.Stock) <= 0)) return false;
        if (activeFilters.categories.size > 0 && !activeFilters.categories.has(p.Category)) return false;
        if (activeFilters.search) {
          const hay = (p.ProductName + ' ' + (p.Detail1||'') + ' ' + (p.Detail2||'') + ' ' + (p.Detail3||'') + ' ' + (p.Detail4||'') + ' ' + (p.Detail5||'')).toLowerCase();
          if (!hay.includes(activeFilters.search)) return false;
        }
        return true;
      });

      if (filtered.length === 0) {
        listEl.innerHTML = '<div style="padding:20px; color:#666;">No products found</div>';
        return;
      }

      filtered.forEach(p => {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.innerHTML = `
          <img src="${p.ImageURL || 'images/placeholder.png'}" alt="${p.ProductName}" onerror="this.src='images/placeholder.png'">
          <div class="p-body">
            <h4 class="p-title">${p.ProductName}</h4>
            <div class="p-cat">${p.Category}</div>
            <div class="p-details">${[p.Detail1,p.Detail2,p.Detail3,p.Detail4,p.Detail5].filter(Boolean).join(', ')}</div>

            <div class="prices">
              <div class="mrp">${p.MRP ? '₹'+parseFloat(p.MRP).toFixed(2) : ''}</div>
              ${p.Discount1pcPercent ? `<div class="discount">1 pc Discount – ${p.Discount1pcPercent}% off</div>` : ''}
              ${p.Discount5pcPercent ? `<div class="discount">5 pc Discount – ${p.Discount5pcPercent}% off</div>` : ''}
            </div>

            <button class="btn-buy" onclick="buyWhatsApp('${encodeURIComponent(p.ProductName)}')">Buy via WhatsApp</button>
            <div class="stock">${(p.Stock && parseInt(p.Stock) > 0) ? 'In stock' : 'Out of stock'}</div>
          </div>
        `;
        listEl.append(card);
      });
    }

    function buyWhatsApp(prod) {
      const product = decodeURIComponent(prod);
      const msg = `Hi, I want to buy *${product}*.\nName:\nAddress:`;
      window.open(`https://wa.me/918149520594?text=${encodeURIComponent(msg)}`, '_blank');
    }

    loadProducts();
  </script>
</body>
</html>
