<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BeautyBucket — Shop Cosmetics</title>
<style>
:root{
  --bg:#f6f6f8; --card:#fff; --text:#111; --muted:#666;
  --accent1:#ff5aa8; --accent2:#ff7ab0; --success:#25D366; --glass: rgba(255,255,255,0.6);
}
[data-theme="dark"]{
  --bg:#0b0d10; --card:#0f1114; --text:#e6e7ea; --muted:#9aa0a6; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:var(--text);-webkit-font-smoothing:antialiased}
a,button{font-family:inherit;cursor:pointer}
.container{max-width:1100px;margin:0 auto;padding:16px}
.site-header{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;padding:16px;border-radius:10px}
.site-header .row{display:flex;align-items:center;gap:12px;justify-content:space-between}
/* Prevent header from stretching when logo height increases */
.site-header {
  height: 100px;       /* adjust if needed */
  overflow: hidden;
}

.site-header img {
  max-height: auto;   /* same as above */
  width: auto;
}

.brand{font-weight:700;font-size:20px}
.sub{font-size:13px;opacity:0.95;margin-top:4px}
.controls{display:flex;gap:8px;align-items:center}
.dark-toggle{padding:8px;border-radius:10px;background:transparent;color:#fff;border:1px solid rgba(255,255,255,0.12)}
.top-bar{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:8px 0 12px}
#searchInput{flex:1 1 220px;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff}
#pincodeInput{width:130px;padding:8px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:#fff}
#pincodeMessage{width:100%;font-size:13px;color:var(--muted);margin-top:6px}
.filters-row{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
.cat-btn{padding:8px 12px;border-radius:999px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--text);cursor:pointer;box-shadow:0 6px 20px rgba(16,24,40,0.03)}
.cat-btn.active{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;transform:translateY(-3px);box-shadow:0 18px 40px rgba(255,90,168,0.12)}
#clearFilters{padding:8px 12px;border-radius:999px;background:#333;color:#fff;cursor:pointer;display:none;box-shadow:0 6px 20px rgba(16,24,40,0.03)}
.products{display:grid;grid-template-columns:1fr;gap:18px;margin-bottom:40px}
@media(min-width:800px){.products{grid-template-columns:repeat(2,1fr)}}
@media(min-width:1200px){.products{grid-template-columns:repeat(3,1fr)}}
.product-card{background:var(--card);border-radius:14px;padding:12px;border:1px solid rgba(16,24,40,0.04);display:flex;flex-direction:column;min-height:300px;box-shadow:0 8px 28px rgba(16,24,40,0.04);transition:transform .18s,box-shadow .18s;position:relative}
.imgwrap{height:160px;border-radius:10px;background:linear-gradient(180deg,#fff,#fcfcfd);display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
.imgwrap img{max-width:100%;max-height:100%;object-fit:contain;display:block;opacity:0.9}
.watermark{position:absolute;bottom:8px;left:8px;background:rgba(255,255,255,0.6);padding:4px 8px;border-radius:6px;font-size:12px;font-weight:600;color:#111}
.p-body{padding:12px 6px 6px;display:flex;flex-direction:column;gap:6px;flex:1}
.p-title{font-weight:600;font-size:16px;display:flex;align-items:center;gap:8px}
.p-cat{color:var(--muted);font-size:13px}
.p-details{color:var(--muted);font-size:13px;min-height:36px}
.prices{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:auto;font-size:14px}
.mrp{color:#9aa0a6;text-decoration:line-through}
.sp{font-weight:700;font-size:15px}
.discount{color:#d10000;font-size:13px}
.stock-info{font-size:13px;color:#888}
.card-actions{display:flex;gap:8px;align-items:center;margin-top:10px}
.btn-buy{background:var(--success);color:#fff;padding:6px 12px;border-radius:10px;border:0;font-weight:700;cursor:pointer}
.out-of-stock-overlay{position:absolute;left:12px;top:12px;background:rgba(255,0,0,0.9);color:#fff;padding:6px 8px;border-radius:8px;font-weight:700;z-index:10}
.spinner-wrap{display:flex;align-items:center;justify-content:center;padding:30px}
.spinner{width:44px;height:44px;border-radius:50%;border:5px solid rgba(0,0,0,0.07);border-top-color:var(--accent1);animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#errorMsg{color:#c00;padding:20px}
.muted{color:var(--muted);font-size:13px}
.slider{position:relative;overflow:hidden;border-radius:10px;margin-bottom:16px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#fff;padding:16px;font-weight:600;font-size:14px;text-align:center}
</style>
</head>
<body>
<header class="site-header">
  <div class="container">
    <div class="row">

      <div style="display:flex;align-items:center;gap:12px;">
        <img src="https://raw.githubusercontent.com/AmirShaikh-aprofile/BeautyBucket-Repo/main/BeautyBucket-Logo-New.png" alt="BeautyBucket Logo" style="height:100px; width:auto;">
      </div>

      <div class="controls">
        <button id="themeToggle" class="dark-toggle" title="Toggle dark mode"></button>
      </div>

    </div>
  </div>
</header>

<div class="container">
  <div class="slider" id="sliderMessage">Limited time offer: Up to 40% off</div>
  
  <div class="top-bar">
    <div style="flex:1;display:flex;gap:8px;align-items:center">
      <input id="searchInput" placeholder="Search products..." aria-label="Search products">
      <input id="pincodeInput" placeholder="Pincode" aria-label="Pincode">
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <div id="pincodeMessage" class="muted">Enter the Pincode to check delivery options</div>
    </div>
  </div>

  <div class="filters-row" id="categoryFilters"></div>
  <div id="clearFilters">Clear filters</div>

  <div id="productList" class="products" aria-live="polite"></div>
  <div id="spinner" class="spinner-wrap" style="display:none"><div class="spinner"></div></div>
  <div id="errorMsg" style="display:none"></div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQA2pIOTPv2AVnMSWtlKLJeSXQXxTllgHn2gGYcdd_ZbHARLmclz_OXy009Aw9hJqgpc-RXIk_HXkK4/pub?gid=1550466309&single=true&output=csv";
const PLACEHOLDER = "https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?w=900&q=80&auto=format&fit=crop";
let allProducts = [];
const filters = { categories: new Set(), search: '' };

// Pincode lists
const FREE_PINCODES = ['411028','411060','412308','412307','411036','411013'];
const PORTAR_PINCODES = ['411004','411040','410506','410509','413132','411032','411035','412411','412205','412201','412105','412211','412206','410507','411042','410401','411046','410501','410505','412218','411003','412408','411051','412410','410502','413114','412212','411021','412401','412207','412404','411007','411027','412406','412402','412405','412204','411002','411045','413102','413133','413103','413801','412108','413104','412303','412203','412209','413130','413105','412301','411026','411039','412106','411038','410513','411037','413106','412202','412208','411001','411031','410503','412114','412409','411019','412101','411005','412213','411012','412305','412311','412109','412214','413110','410508','412403','411043','411015','411041','411014','412216','410516','413120','411016','412210','412102','412104','411028','411013','410504','412306','411025','411057','410402','412215','412107','410403','411017','410405','412412','412219','412220','411052','411034','411011','411024','413116','410301','411048','412103','411023','410511','413802','410512','411047','411030','410510','410515','413115','412307','411018','412304','411036','411008','411044','411009','410406','412308','410302','411020','411022','412110','412312','411058','411006','411060'];

function updatePincodeMessage(){
  const val = document.getElementById('pincodeInput').value.trim();
  const msgEl = document.getElementById('pincodeMessage');
  if(FREE_PINCODES.includes(val)) msgEl.innerHTML = '<b>Free Instance Delivery For You</b>';
  else if(PORTAR_PINCODES.includes(val)) msgEl.textContent = 'Instance Delivery with Portar';
  else msgEl.textContent = 'Delivery charges is Applicable';
}
document.getElementById('pincodeInput').addEventListener('input', updatePincodeMessage);

function parseCSV(csv) {
  const lines = csv.trim().split(/\r?\n/);
  const headers = lines.shift().split(',').map(h => h.trim());

  return lines.map(line => {
    const values = [];
    let inQuotes = false;
    let value = '';

    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === ',' && !inQuotes) {
        values.push(value.trim());
        value = '';
      } else {
        value += char;
      }
    }
    values.push(value.trim());

    // remove surrounding quotes if any and unescape double quotes
    for (let i = 0; i < values.length; i++) {
      let v = values[i];
      if (v.startsWith('"') && v.endsWith('"')) {
        v = v.slice(1, -1).replace(/""/g, '"');
      }
      values[i] = v;
    }

    const obj = {};
    headers.forEach((h, i) => obj[h] = values[i] || '');
    return obj;
  });
}
function fetchProducts(){
  document.getElementById('spinner').style.display='flex';
  fetch(CSV_URL)
    .then(r=>r.text())
    .then(text=>{
      allProducts = parseCSV(text);
      allProducts.forEach(p=>{
        p.Name = p.ProductName || '';
        p.Description = p.Details || '';
        p.category = p.Category || 'Uncategorized';
        p.stock = parseInt(p.Stock||0);
        p.price1pc = parseFloat(p.SellingPrice1pc||0);
        p.mrp = parseFloat(p.MRP.replace(/[^0-9.]/g,'')); // remove anything not a number/dot
        if (isNaN(p.mrp)) p.mrp = parseFloat(p.price1pc) || 0;
        p.discount1pc = p.Discount1pcPercent || '';
        p.images = p.ImageURL ? p.ImageURL.split('|') : [PLACEHOLDER];
      });
      renderCategoryFilters();
      renderProducts();
    }).catch(e=>{
      document.getElementById('spinner').style.display='none';
      const msg = document.getElementById('errorMsg');
      msg.style.display='block';
      msg.textContent = 'Error loading products.';
      console.error(e);
    });
}

function renderCategoryFilters(){
  const container = document.getElementById('categoryFilters');
  container.innerHTML='';
  const categories = Array.from(new Set(allProducts.map(p=>p.category)));
  categories.forEach(cat=>{
    const btn = document.createElement('button');
    btn.className='cat-btn';
    btn.textContent=cat;
    btn.onclick=()=>{
      if(filters.categories.has(cat)) filters.categories.delete(cat);
      else filters.categories.add(cat);
      updateFilterUI();
      renderProducts();
    };
    container.appendChild(btn);
  });
}

function updateFilterUI(){
  document.querySelectorAll('.cat-btn').forEach(btn=>{
    btn.classList.toggle('active', filters.categories.has(btn.textContent));
  });
  document.getElementById('clearFilters').style.display = filters.categories.size>0 ? 'inline-block':'none';
}

document.getElementById('clearFilters').onclick=()=>{
  filters.categories.clear();
  updateFilterUI();
  renderProducts();
};

function renderProducts(){
  const container = document.getElementById('productList');
  container.innerHTML='';
  let filtered = allProducts.filter(p=>{
    return (filters.categories.size===0 || filters.categories.has(p.category)) &&
           (p.Name.toLowerCase().includes(filters.search.toLowerCase()));
  });
  filtered.forEach(p=>{
    const card = document.createElement('div');
    card.className='product-card';
    card.innerHTML = `
      <div class="imgwrap">
        <img src="${p.images[0]}" alt="${p.Name}">
      </div>
      <div class="p-body">
        <div class="p-title">${p.Name}</div>
        <div class="p-cat">${p.category}</div>
        <div class="p-details">${p.Description}</div>
        <div class="prices">
          <span class="mrp">₹${p.mrp}</span>
          <span class="sp">SP: ₹${p.price1pc}</span>
          ${p.discount1pc ? `<span class="discount">${p.discount1pc}</span>` : ''}
        </div>

        <div class="stock-info">Stock: ${p.stock}</div>
      </div>
      ${p.stock<=0?'<div class="out-of-stock-overlay">Out of stock</div>':''}
      <div class="card-actions"><button class="btn-buy">Buy</button></div>
    `;
    container.appendChild(card);
  });
  document.getElementById('spinner').style.display='none';
}

document.getElementById('searchInput').addEventListener('input',(e)=>{
  filters.search = e.target.value;
  renderProducts();
});

// Slider rotation
const sliderMessages = ["Limited time offer: Up to 40% off", "Clean, cruelty-free formulas"];
let currentSlide = 0;
setInterval(()=>{
  currentSlide = (currentSlide+1)%sliderMessages.length;
  document.getElementById('sliderMessage').textContent = sliderMessages[currentSlide];
},4000);

fetchProducts();
</script>
</body>
</html>
